<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Phaser Swing Game</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <style>
    body { margin:0; padding:0; overflow:hidden; }
    canvas { display:block; }
  </style>
</head>
<body>
<script>
class StartScene extends Phaser.Scene {
  constructor() { super({ key: 'StartScene' }); }

  preload() {
    this.load.image('start', 'image/start.jpg');
    this.load.image('start_button', 'image/start_button.png');
    this.load.image('exit_button', 'image/exit_button.png');
    this.load.image('background', 'image/background.jpg');
    this.load.image('background2', 'image/background1.jpg'); // 새로운 배경
    this.load.image('start_swing', 'image/start_swing.png'); 
    this.load.image('swing', 'image/swing.png');             
    this.load.image('finish_swing', 'image/finish_swing.png'); 
  }

  create() {
    const bg = this.add.image(0,0,'start').setOrigin(0,0);
    const scaleX = this.sys.game.config.width / bg.width;
    const scaleY = this.sys.game.config.height / bg.height;
    bg.setScale(Math.max(scaleX, scaleY));

    const btnY = this.sys.game.config.height - 200;
    const spacing = 500;

    const exitBtn = this.add.image(this.sys.game.config.width/2 - spacing, btnY, 'exit_button').setInteractive();
    const startBtn = this.add.image(this.sys.game.config.width/2 + spacing, btnY, 'start_button').setInteractive();

    exitBtn.on('pointerdown', () => { console.log('게임 종료'); });
    startBtn.on('pointerdown', () => { this.scene.start('GameScene'); });
  }
}

class GameScene extends Phaser.Scene {
  constructor() { super({ key: 'GameScene' }); }

  create() {
    const bg = this.add.image(0,0,'background').setOrigin(0,0);
    const scaleX = this.sys.game.config.width / bg.width;
    const scaleY = this.sys.game.config.height / bg.height;
    bg.setScale(Math.max(scaleX, scaleY));

    const swingY = this.sys.game.config.height - 250;
    this.swing = this.add.image(this.sys.game.config.width/2, swingY, 'start_swing').setScale(3);

    this.input.on('pointermove', pointer => {
      this.swing.x = pointer.x;
    });

    this.ball = null; // 공 하나만 존재

    // 마우스 휠 이벤트
    window.addEventListener('wheel', () => {
      if (this.ball) return; // 공이 이미 발사 중이면 무시

      // 스윙 중
      this.swing.setTexture('swing');

      // 스윙 끝 → 공 발사
      this.time.delayedCall(200, () => {
        this.swing.setTexture('finish_swing');

        const ball = this.add.circle(this.swing.x, swingY + 20, 40, 0xff0000); // 공 위치 아래쪽, 크기 40
        this.ball = ball;

        this.tweens.add({
          targets: ball,
          y: this.sys.game.config.height / 2,  // 중간 지점
          scale: 0.5,                           // 점점 작아짐
          duration: 1500,
          ease: 'Power1',
          onComplete: () => { 
            ball.destroy();
            this.ball = null;

            // background2로 변경
            const bg2 = this.add.image(0,0,'background2').setOrigin(0,0);
            const scaleX2 = this.sys.game.config.width / bg2.width;
            const scaleY2 = this.sys.game.config.height / bg2.height;
            bg2.setScale(Math.max(scaleX2, scaleY2));
          }
        });
      });

      // 기본 자세로 복원
      this.time.delayedCall(500, () => {
        this.swing.setTexture('start_swing');
      });
    });
  }
}

const config = {
  type: Phaser.AUTO,
  width: window.innerWidth,
  height: window.innerHeight,
  scene: [StartScene, GameScene]
};

const game = new Phaser.Game(config);

window.addEventListener('resize', () => {
  game.scale.resize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
